## Terminology

- A Docker *Image* is a read-only template used to create [[Containerization|containers]]. 
    - It includes everything needed to run an application, such as code, libraries, and environment variables.
- A *container* is a runnable instance of a Docker image. 
    - It is isolated from other containers and the host system.
- A `Dockerfile` is a script containing a series of instructions on how to build a Docker image. 
    - It specifies the base image, application code, dependencies, and commands to run the application.
- *Docker Compose* is a tool for defining and running multi-container Docker applications. 
    - Using a `docker-compose.yml` file, all of the application's services (such as databases), networks, and volumes can be configured in one place.
    - `docker-compose build` - builds the image.
    - `docker-compose up` - starts all services defined in the file.
    - `docker-compose down` - stops and removes containers, networks, volumes, and images defined in a `docker-compose.yml` file.
    - **Anatomy** 
        - `services` - where you define the various containers that make up your application. 
            - Each service corresponds to a container and can include various configurations such as the image to use, build context, environment variables, and more.
        - `build` - used to build a custom image for a service.
            - It points to the directory containing the `Dockerfile`.
        - `volumes` - used to persist data generated by and used by Docker containers. 
            - Used to ensure data is not lost when containers are stopped.
- *Docker Hub* is a cloud-based registry where you can find and share Docker images. 
    - Images can be pulled from Docker Hub or pushed for others to use.

## Examples

### Minimal

```dockerfile
# Use the official Node.js image as a base
FROM node:14

# Set the working directory
WORKDIR /app

# Copy package.json and install dependencies
COPY package*.json ./
RUN npm install

# Copy the rest of the application code
COPY . .

# Expose the application port
EXPOSE 3000

# Command to run the application
CMD ["npm", "start"]
```

```bash
# Inside the Project Directory
# Build the Docker image
docker build -t my-node-app .

# Run the Docker container
docker run -p 3000:3000 my-node-app
```

### PERN

```
my-fullstack-app/
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ App.js
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ .env
```

```js
const { Pool } = require('pg');

const app = express();

const pool = new Pool({
    connectionString: process.env.DATABASE_URL,
});

pool.query(`
    CREATE TABLE IF NOT EXISTS todos (
        id SERIAL PRIMARY KEY,
        text VARCHAR(255) NOT NULL
    )
`);

app.get('/api/todos', async (req, res) => {
    try {
        const result = await pool.query('SELECT * FROM todos');
        res.json(result.rows);
    } catch (err) {
        res.status(500).json({ error: 'Internal server error' });
    }
});

app.post('/api/todos', async (req, res) => {
    try {
        const { text } = req.body;
        const result = await pool.query('INSERT INTO todos (text) VALUES ($1) RETURNING *', [text]);
        res.status(201).json(result.rows[0]);
    } catch (err) {
        res.status(500).json({ error: 'Internal server error' });
    }
});
```

```dockerfile
# Backend Dockerfile
FROM node:14
WORKDIR /usr/src/app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 5000
CMD ["npm", "start"]
```

```dockerfile
# Frontend Dockerfile
FROM node:14
WORKDIR /usr/src/app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npx", "serve", "-s", "build"]
```

```yml
# docker-compose.yml
version: '3'
services:
    frontend:
        build: ./frontend
        ports:
            - "3000:3000"
        depends_on:
            - backend
    backend:
        build: ./backend
        ports:
            - "5000:5000"
        environment:
            - DATABASE_URL=postgres://user:password@db:5432/todos
        depends_on:
            - db
    db:
        image: postgres:13
        environment:
            - POSTGRES_USER=user
            - POSTGRES_PASSWORD=password
            - POSTGRES_DB=todos
        ports:
            - "5432:5432"
        volumes:
            - postgres-data:/var/lib/postgresql/data

volumes:
    postgres-data:
```

```bash
# Run Locally
docker-compose up --build

docker-compose down
```

---

## Skill Gap

- [Docker Roadmap (roadmap.sh)](https://roadmap.sh/docker)

---

## Further

### Learn ðŸ§ 

- [A practical guide on Docker with projects (YouTube)](https://www.youtube.com/watch?v=rr9cI4u1_88)

- [Learn Docker in 1 Hour (YouTube)](https://www.youtube.com/watch?v=GFgJkfScVNU&t=4402s)

### Videos ðŸŽ¥

![Containerization Explained](https://www.youtube.com/watch?v=0qotVMX-J5s&pp=ygUGZG9ja2Vy "Containerization Explained")

